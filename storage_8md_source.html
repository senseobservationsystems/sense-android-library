<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Sense Android Library: documentation/storage.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Sense Android Library
   &#160;<span id="projectnumber">3.4</span>
   </div>
   <div id="projectbrief">Android library project for the Sense Platform</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('storage_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">documentation/storage.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="storage_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor"># Data Storage {#data_storage}</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Sensor data can be stored in and obtained from a local database as well as CommonSense. The data will be stored in the local database first, and be transmitted to CommonSense periodically (see [MsgHandler](documentation/msg_handler.md)). To store the data, sensors need to pass a message to MsgHandler [MsgHandler](documentation/msg_handler.md) by sending an Intent with action_sense_new_data containing the details of the datapoint. This <span class="keyword">new</span> data will be stored and buffered in the local database before being transmitted to CommonSense at a scheduled time.</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;~~~</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;Intent sensorData = <span class="keyword">new</span> Intent(getString(R.string.action_sense_new_data));</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;sensorData.putExtra(DataPoint.SENSOR_NAME, &amp;quot;sensor name&amp;quot;);</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;sensorData.putExtra(DataPoint.VALUE, &amp;quot;foo&amp;quot;);</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;sensorData.putExtra(DataPoint.DATA_TYPE, SenseDataTypes.FLOAT);</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;sensorData.putExtra(DataPoint.TIMESTAMP, System.currentTimeMillis());</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;startService(sensorData);</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;~~~</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor"># Sensor registration {#sensor_registration}</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor"></span>Before a sensor can be uploaded to CommonSense it needs to be created. The SensorRegistrator <span class="keyword">class </span>implements a trivial sensor registration method called `checkSensor` which checks in the back-end whether a sensor with a given description already exists. If the back-end successfully returns and the sensor does not exist then it will be created and the method will return True.</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;SensorRegistrator is implemented in nl.sense_os.service.commonsense.SensorRegistrator.</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;LocalStorage is implemented in nl.sense_os.service.storage.LocalStorage.</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;RemoteStorage is implemented in nl.sense_os.service.storage.RemoteStorage.</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;# Local Storage {#local_storage}</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;The Sense Library provides LocalStorage that will <span class="keyword">abstract</span> the data storage mechanism. This <span class="keyword">class </span>is implemented with the singleton pattern, so there will be only one instance that manages the local data storage. This class provides several functionalities regarding data storage, for example:</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;* insert new data,</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;* delete existing data,</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;* update existing data, and</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;* query for data</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;Query can be done with two different URI path schemes, as follows:</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;* [CONTENT_URI_PATH](@ref nl.sense_os.service.constants.SensorData.DataPoint.CONTENT_URI_PATH) scheme, will get the data from both inMemory and persisted</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;* [CONTENT_REMOTE_URI_PATH](@ref nl.sense_os.service.constants.SensorData.DataPoint.CONTENT_REMOTE_URI_PATH) will get the data from commonSense</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;In case of [CONTENT_REMOTE_URI_PATH](@ref nl.sense_os.service.constants.SensorData.DataPoint.CONTENT_REMOTE_URI_PATH), LocalStorage becomes a proxy to RemoteStorage. See nl.sense_os.service.storage.LocalStorage.query).</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;LocalStorage is implemented in nl.sense_os.service.storage.LocalStorage</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">## SQLite Database {#sqlite_database}</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;Local data will be stored in an encrypted SQLite database (see nl.sense_os.service.storage.SQLiteStorage and nl.sense_os.service.storage.DbHelper).</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;The data stored in the database will have the following fields (see nl.sense_os.service.storage.LocalStorage.DEFAULT_PROJECTION):</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;* ID</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;* SENSOR_NAME</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;* DISPLAY_NAME</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;* SENSOR_DESCRIPTION</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;* DATA_TYPE,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;* VALUE</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;* TIMESTAMP</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;* DataPoint.DEVICE_UUID</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;* TRANSMIT_STATE</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">## In RAM &amp; In Flash Storage {#RAM_and_Flash_storage}</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;Internally, LocalStorage will use two instances of SQLite to actually store the data, one in memory (RAM) and one in a file (Flash). The data in file will be persistent even when the application is killed, while the data in memory (RAM) will vanish in such cases. The data will internally be buffered in memory (RAM) first, and will be moved into file database when certain conditions are met:</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;* in memory database overflows when inserting data</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;* manually call update function with “persist=true” query parameter</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;The data in memory (RAM) database will be deleted when it is moved to in file database.</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">## Retention Rate {#retention_rate}</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;Old data in persistent database will be deleted after it exceeds the retention time (and has been sent to CommonSense, if applicable). The Retention Time is gathered from preferences (see nl.sense_os.service.constants.SensePrefs.Main.Advanced.RETENTION_HOURS), and has a default value of 24 hours (see nl.sense_os.service.storage.LocalStorage.DEFAULT_RETENTION_HOURS).</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="storage_8md.html">storage.md</a></li>
    <li class="footer">Generated on Mon Mar 30 2015 17:48:13 for Sense Android Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
