<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Sense Android Library: Data Storage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Sense Android Library
   &#160;<span id="projectnumber">2.7.0</span>
   </div>
   <div id="projectbrief">Android library project for the Sense Platform</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_docs_storage.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Data Storage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Sensor data can be stored in and obtained from local database as well as CommonSense. The data will be stored in local database first, and transmitted to CommonSense periodically. To store the data, sensor need to pass a message to MsgHandler by sending an Intent with action_sense_new_data containing the details of datapoint. This new data will be stored and buffered in Local database before transmitted to CommonSense at scheduled time.</p>
<ul>
<li>Intent sensorData = new Intent(getString(R.string.action_sense_new_data));</li>
<li>sensorData.putExtra(DataPoint.SENSOR_NAME, "sensor name");</li>
<li>sensorData.putExtra(DataPoint.VALUE, "foo");</li>
<li>sensorData.putExtra(DataPoint.DATA_TYPE, SenseDataTypes.FLOAT);</li>
<li>sensorData.putExtra(DataPoint.TIMESTAMP, System.currentTimeMillis());</li>
<li>startService(sensorData);</li>
</ul>
<h2>Local Storage</h2>
<p>Sense library provide LocalStorage that will abstract the data storage mechanism. This class is implemented with singleton pattern, so there will be only one instance that managing the local data storage. This class provide several functionality regards to data storage, for example : insert new data, delete existing data, update existing data, and query for data</p>
<p>Particular for query functionality, LocalStorage instance could also behave as a proxy to query data from commonSense by using REMOTE_VALUES_URI scheme.</p>
<p>Internally, LocalStorage will use two instance of SQLite to actually store the data, one in memory and one more in a file. The data in file will be persistent even when application killed, while the data in memory will be vanish in such case. The data will internally buffered in memory first, and will be moved into file database at certain condition : in memory database become overflow when inserting data call update function with “persist=true” query parameter</p>
<p>the data in memory database will be deleted when data moved to in file database.</p>
<p>Sense data will be stored locally as encrypted SQLite database with such field at minimal: ID SENSOR_NAME DISPLAY_NAME SENSOR_DESCRIPTION DATA_TYPE, VALUE TIMESTAMP DataPoint.DEVICE_UUID TRANSMIT_STATE</p>
<h2>Remote Storage</h2>
<h2>CommonSense</h2>
<p>Sensor Data is stored and gathered from several place: RAM, Flash, commonSense</p>
<p>Initially the data is stored in device’s RAM (inMemory), In case the memory becomes too full, the data is offloaded into a persistent database in the flash memory. This process is hidden to the end user, so you do not have to worry about which data is where. But it’s still possible to manually persist the current data in inMemory database by calling update on LocalStorage instance with “persist” query parameter set to “true”.</p>
<p>Uri contentUri = Uri.parse("content://" + getString(R.string.local_storage_authority)</p>
<ul>
<li>DataPoint.CONTENT_URI_PATH + "?persist=true"); String where = DataPoint.TRANSMIT_STATE + "=" + 0; storage.update(contentUri, new ContentValues(), where, null);</li>
</ul>
<p>Old data in persistent database will be deleted after exceed retention time (and not sended yet in case using commonSense). Retention times is gathered from preferences, or 24 hour by default.</p>
<p>inMemory and persisted is implemented as SQLiteStorage</p>
<p>Query with LOCAL_VALUES_URI will get the data from both inMemory and persisted, while query from REMOTE_VALUES_URI will get the data from commonSense. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Mar 27 2015 18:00:10 for Sense Android Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
