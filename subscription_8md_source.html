<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Sense Android Library: documentation/subscription.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Sense Android Library
   &#160;<span id="projectnumber">2.7.0</span>
   </div>
   <div id="projectbrief">Android library project for the Sense Platform</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('subscription_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">documentation/subscription.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="subscription_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor"># Data Subscription {#data_subscription}</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor"># Subscription Manager {#subscription_manager}</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Sense Library provides SubscriptionManager to keep all of the available producers and subscribers as well as relations between them. Every sensor in sense library should be registered to <span class="keyword">this</span> SubscriptionManager instance.</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;This <span class="keyword">class</span>, like most of other <span class="keyword">class </span>in Sense Library, is implemented with singleton pattern. It&#39;s implemented in nl.sense_os.service.subscription.SubscriptionManager.</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;A [DataProducer](##DataProducer) can register to [SubscriptionManager](##SubscribtionManager) instance with a given name. One name in SubscriptionManager could be registered to one or more different DataProducer instances. Registering an existing instance of DataProducer will result in doing nothing.</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;A [DataConsumer](##DataConsumer) can subscribe to one or more [DataProducer](##DataProducer) registered under a certain name. If there is no DataProducer for this name yet, SubscriptionManager will still store it as a subscriber and subscribe it when a new DataProducer is registered with that name.</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;# Data Producer {#data_producer}</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;DataProducer is an <span class="keyword">interface </span>that specifies some functionality for objects that produce data, specifically [SensorDataPoint](##SensorDataPoint) objects, so that one or more [DataConsumer](##DataConsumer) can subscribe to it. Every sensor in Sense Library is an implementation of DataProducer. </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;Sense library provides a base implementation of this interface in nl.sense_os.service.subscription.BaseDataProducer abstract class, and almost all of sensors in Sense library are based on this class. BaseDataProducer will store all of its subcribers in an ArrayList. This class also provides a mechanisme to notify all of its subscribers when there are new samples, and also send the SensorDataPoint to some or all of its subscribers when the sampling is finished. BaseDataProducer object will check the status of its DataConsumers to see if they have received all the data they need before sending the data.</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;DataProducer can register to SubscriptionManager so a DataConsumer can subscribe to it. Here is an example of how to register a producer to SubscriptionManager</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;~~~</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;mSubscrMgr = SubscriptionManager.getInstance();</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;testSensor = TestSensor.getInstance(ctx);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;mSubscrMgr.registerProducer(“TestSensor”, testSensor);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;~~~</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;BaseDataProducer objects like sensors should also notify and send the datapoint everytime there is a <span class="keyword">new</span> sample. Here is an example of how to notify and send sensor data to subscribers when there is a <span class="keyword">new</span> sample.</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;~~~</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;notifySubscribers();</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;SensorDataPoint dataPoint = <span class="keyword">new</span> SensorDataPoint(value);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;dataPoint.sensorName = <span class="stringliteral">&quot;Sensor name&quot;</span>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;dataPoint.sensorDescription = <span class="stringliteral">&quot;Sensor description&quot;</span>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;dataPoint.timeStamp = startTimestamp;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;sendToSubscribers(dataPoint);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;~~~</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor"># Data Consumer {#data_consumer}</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;DataConsumer is an <span class="keyword">interface </span>that specifies some functionality for objects to subscribe to one or more [DataProducer](##DataProducer). By subscribing to a DataProducer, a DataConsumer object will get a notification every time there is a new datapoint, as well as get the actual data. Any class that <span class="keyword">implements</span> this interface also needs to implement a function that enables the DataProducer to check if the DataConsumer object has all of the data it needs before sending the actual data.</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;FallDetector and EpilepsySensor are examples of DataConsumer.</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;DataConsumer can subscribe to a DataProducer directly or through SubscriptionManager. Here is an example on how to subscribe a DataConsumer to a data producer directly</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;~~~</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;testConsumerSensor = TestConsumerSensor.getInstance();</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;dataProducer.addSubscriber(testConsumerSensor);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;~~~</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;and here is an example of how to subscribe a DataConsumer to DataProducer in previous example (see DataProducer) using SubscriptionManager.</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;~~~java</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;testConsumerSensor = TestConsumerSensor.getInstance();</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;mSubscrMgr = SubscriptionManager.getInstance();</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;mSubscrMgr.subscribeConsumer(&quot;TestSensor&quot;, testConsumerSensor);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;~~~</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="subscription_8md.html">subscription.md</a></li>
    <li class="footer">Generated on Mon Mar 30 2015 09:23:31 for Sense Android Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
