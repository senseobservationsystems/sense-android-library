<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Sense Android Library: Sense Service</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Sense Android Library
   &#160;<span id="projectnumber">2.7.0</span>
   </div>
   <div id="projectbrief">Android library project for the Sense Platform</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_docs_sense_service.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Sense Service </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is main sense service class from which application can binded to.</p>
<p>Activities or other component that binded to sense service can not access the SenseService directly, but through <a class="el" href="classnl_1_1sense__os_1_1service_1_1_sense_service_stub.html">nl.sense_os.service.SenseServiceStub</a> instance, that can be gathered from the <a class="el" href="classnl_1_1sense__os_1_1service_1_1_sense_service_1_1_sense_binder.html">nl.sense_os.service.SenseService.SenseBinder</a> instance refered in onServiceConnected callback of ServiceConnection defined when binding the service (see Binding). Through this SenseServiceStub instance, application could then retrieve some functionality:</p>
<ul>
<li>Register user</li>
<li>Login/Logout</li>
<li>Toggle (start/stop) main sensing</li>
<li>Toggle (start/stop) individual sensor</li>
<li>Get/Set settings preferences</li>
</ul>
<p>SenseService is implemented as singleton, and it has an instance of <a class="el" href="classnl_1_1sense__os_1_1service_1_1_service_state_helper.html">nl.sense_os.service.ServiceStateHelper</a> to keep its state. It also has an instance of <a class="el" href="classnl_1_1sense__os_1_1service_1_1subscription_1_1_subscription_manager.html">nl.sense_os.service.subscription.SubscriptionManager</a> to manage all available sensor in a producer-subscriber model (see Data Subcription).</p>
<p>SenseService should always running as a foreground service, and should not being killed except being stop explicitly. There is also another component <a class="el" href="classnl_1_1sense__os_1_1service_1_1_alive_checker.html">nl.sense_os.service.AliveChecker</a> that will check the service periodically and make sure it keeps running.</p>
<p>SenseService is implemented in <a class="el" href="classnl_1_1sense__os_1_1service_1_1_sense_service.html">nl.sense_os.service.SenseService</a>.</p>
<h2>Binding</h2>
<p>Sense Service is a service that others component (application) could bind to. It will return <a class="el" href="classnl_1_1sense__os_1_1service_1_1_sense_service_1_1_sense_binder.html">nl.sense_os.service.SenseService.SenseBinder</a> object to bounded component through a derivative of android.content.ServiceConnection when connected. Through this binder, the component could get a <a class="el" href="classnl_1_1sense__os_1_1service_1_1_sense_service_stub.html">nl.sense_os.service.SenseServiceStub</a> object which provide interface for SenseService functionality.</p>
<p>Here an example from SensePlatform on how to bind to Sense Service. </p>
<pre class="fragment">final Intent serviceIntent = new Intent(getContext(), nl.sense_os.service.SenseService.class);
boolean bindResult = mContext.bindService(serviceIntent, mServiceConnection, Context.BIND_AUTO_CREATE);
</pre><p>And here is an example of onServiceConnected callback of ServiceConnection class that will receive the binder when connected to service (also from SensePlatform). </p>
<pre class="fragment">    @Override
    public void onServiceConnected(ComponentName className, IBinder binder) {
        Log.v(TAG, "Bound to Sense Platform service...");

        mSenseService = ((SenseBinder) binder).getService();
    }
</pre><p>Some of functionality in SenseServiceStub provide callback mechanism implementing AIDL interface defined in nl.sense_os.service.ISenseServiceCallback. This interface provide several callback function :</p>
<ul>
<li>statusReport, return the current status of SenseService</li>
<li>onChangeLoginResult, called when login status is change</li>
<li>onRegisterResult, called when finish registering a user</li>
</ul>
<p>This is an example of how to use the callback mechanism in login case. </p>
<pre class="fragment">    mSenseService.changeLogin(username,     SenseApi.hashPassword(password), this.mServiceCallback);
</pre><p>And this is the definition mServiceCallback for such example. </p>
<pre class="fragment">private final ISenseServiceCallback mServiceCallback = new ISenseServiceCallback.Stub() {
    @Override
    public IBinder asBinder() {
            return null;
    }

    @Override
    public void onChangeLoginResult(final int result) throws RemoteException {

            // 0 if login completed successfully, -2 if login was forbidden,
            // and -1 for any other errors.

            if (result == -2) {
                    onLoginFailure(LoginActivityFrag.this.ERROR_CREDENTIAL);

            } else if (result == -1) {
                    onLoginFailure(LoginActivityFrag.this.ERROR_CREDENTIAL);

            } else {
                    onLoginSuccess();
            }
    }
}
</pre><h2>Manage/Stopping (Main / Sensor groups)</h2>
<p>SenseService provide several method to toggle the main state as well as sensor groups state (see Sensor Groups). There is a toggle method for each of the sensor groups. Here is an example of how to toggle the states of several sensor groups and the main service. </p>
<pre class="fragment">// enable some specific sensor modules
senseService.togglePhoneState(true);
senseService.toggleAmbience(true);
senseService.toggleMotion(true);
senseService.toggleLocation(true);

// enable main service state
senseService.toggleMain(true);
</pre><h2>Background service</h2>
<p>The SenseService will start as a service when <a class="el" href="classnl_1_1sense__os_1_1service_1_1_sense_service.html#a5c7ac00f65e121c2add9e893b68227d2">nl.sense_os.service.SenseService.toggleMain</a> method is called with true argument, It will also registers itself as foreground service so it doesn’t easily killed by Android when the system low on memory. It will also being start as STICKY service so android know to start it again if it’s accidentally been killed.</p>
<p>When the service started, it will try to start available sensor based on preferences. It will also start scheduling for data transmission to commonSense. Finally it will send broadcast so any other component could be notified that the sense service already start (see Start Broadcast).</p>
<p>Each of sensor groups will also be run in different thread, and will keep exist while the service running.</p>
<h2>Start Broadcast</h2>
<p>Sense Service will broadcast <em>action_sense_service_broadcast</em> action everytime :</p>
<ul>
<li>The service started</li>
<li>Sensor modules started/stop</li>
</ul>
<p>The broadcast receiver then could check the service status through <a class="el" href="classnl_1_1sense__os_1_1service_1_1_service_state_helper.html">nl.sense_os.service.ServiceStateHelper</a> instance.</p>
<h2>Alive Checker</h2>
<p>SenseService has an instance of AliveChecker to make sure that keep running when it should be. It will start checking periodically when SenseService starts sensing.</p>
<p>Alive Checker will check every 15 minute if the phone is awake, and it will make sure to wake up every 1 hour. It will make sure the SenseService keep running by trying to start the service regardless of current state. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Mar 27 2015 18:00:10 for Sense Android Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
