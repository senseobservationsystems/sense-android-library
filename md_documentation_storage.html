<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Sense Android Library: Data Storage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Sense Android Library
   &#160;<span id="projectnumber">2.7.0</span>
   </div>
   <div id="projectbrief">Android library project for the Sense Platform</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_documentation_storage.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Data Storage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Sensor data can be stored in and obtained from a local database as well as CommonSense. The data will be stored in the local database first, and be transmitted to CommonSense periodically (see <a class="el" href="md_documentation_msg_handler.html">MsgHandler</a>). To store the data, sensors need to pass a message to MsgHandler <a class="el" href="md_documentation_msg_handler.html">MsgHandler</a> by sending an Intent with action_sense_new_data containing the details of the datapoint. This new data will be stored and buffered in the local database before being transmitted to CommonSense at a scheduled time.</p>
<div class="fragment"><div class="line">Intent sensorData = <span class="keyword">new</span> Intent(getString(R.string.action_sense_new_data));</div>
<div class="line">sensorData.putExtra(DataPoint.SENSOR_NAME, &amp;quot;sensor name&amp;quot;);</div>
<div class="line">sensorData.putExtra(DataPoint.VALUE, &amp;quot;foo&amp;quot;);</div>
<div class="line">sensorData.putExtra(DataPoint.DATA_TYPE, SenseDataTypes.FLOAT);</div>
<div class="line">sensorData.putExtra(DataPoint.TIMESTAMP, System.currentTimeMillis());</div>
<div class="line">startService(sensorData);</div>
</div><!-- fragment --><p>Before a sensor can be uploaded to CommonSense it needs to be created. The SensorRegistrator class implements a trivial sensor registration method called <code>checkSensor</code> which checks in the back-end whether a sensor with a given description already exists. If the back-end successfully returns and the sensor does not exist then it will be created and the method will return True.</p>
<p>SensorRegistrator is implemented in <a class="el" href="classnl_1_1sense__os_1_1service_1_1commonsense_1_1_sensor_registrator.html">nl.sense_os.service.commonsense.SensorRegistrator</a>.</p>
<p>LocalStorage is implemented in <a class="el" href="classnl_1_1sense__os_1_1service_1_1storage_1_1_local_storage.html">nl.sense_os.service.storage.LocalStorage</a>.</p>
<p>RemoteStorage is implemented in <a class="el" href="classnl_1_1sense__os_1_1service_1_1storage_1_1_remote_storage.html">nl.sense_os.service.storage.RemoteStorage</a>.</p>
<h1><a class="anchor" id="local_storage"></a>
Local Storage</h1>
<p>The Sense Library provides LocalStorage that will abstract the data storage mechanism. This class is implemented with the singleton pattern, so there will be only one instance that manages the local data storage. This class provides several functionalities regarding data storage, for example:</p>
<ul>
<li>insert new data,</li>
<li>delete existing data,</li>
<li>update existing data, and</li>
<li>query for data</li>
</ul>
<p>Query can be done with two different URI path schemes, as follows:</p>
<ul>
<li><a class="el" href="classnl_1_1sense__os_1_1service_1_1constants_1_1_sensor_data_1_1_data_point.html#a697b677149c9b9639838551465c4ba27">CONTENT_URI_PATH</a> scheme, will get the data from both inMemory and persisted</li>
<li><a class="el" href="classnl_1_1sense__os_1_1service_1_1constants_1_1_sensor_data_1_1_data_point.html#a2dfcd378ace8d39221afe4a50403f29d">CONTENT_REMOTE_URI_PATH</a> will get the data from commonSense</li>
</ul>
<p>In case of <a class="el" href="classnl_1_1sense__os_1_1service_1_1constants_1_1_sensor_data_1_1_data_point.html#a2dfcd378ace8d39221afe4a50403f29d">CONTENT_REMOTE_URI_PATH</a>, LocalStorage becomes a proxy to RemoteStorage. See <a class="el" href="classnl_1_1sense__os_1_1service_1_1storage_1_1_local_storage.html#ae3b38e350e3668ba660b53ec9121f103">nl.sense_os.service.storage.LocalStorage.query</a>).</p>
<p>LocalStorage is implemented in <a class="el" href="classnl_1_1sense__os_1_1service_1_1storage_1_1_local_storage.html">nl.sense_os.service.storage.LocalStorage</a></p>
<h2><a class="anchor" id="sqlite_database"></a>
SQLite Database</h2>
<p>Local data will be stored in an encrypted SQLite database (see <a class="el" href="classnl_1_1sense__os_1_1service_1_1storage_1_1_s_q_lite_storage.html">nl.sense_os.service.storage.SQLiteStorage</a> and <a class="el" href="classnl_1_1sense__os_1_1service_1_1storage_1_1_db_helper.html">nl.sense_os.service.storage.DbHelper</a>).</p>
<p>The data stored in the database will have the following fields (see <a class="el" href="classnl_1_1sense__os_1_1service_1_1storage_1_1_local_storage.html#a3198721a0d3119513f314115b9f6d690">nl.sense_os.service.storage.LocalStorage.DEFAULT_PROJECTION</a>):</p>
<ul>
<li>ID</li>
<li>SENSOR_NAME</li>
<li>DISPLAY_NAME</li>
<li>SENSOR_DESCRIPTION</li>
<li>DATA_TYPE,</li>
<li>VALUE</li>
<li>TIMESTAMP</li>
<li>DataPoint.DEVICE_UUID</li>
<li>TRANSMIT_STATE</li>
</ul>
<h2><a class="anchor" id="RAM_and_Flash_storage"></a>
In RAM &amp; In Flash Storage</h2>
<p>Internally, LocalStorage will use two instances of SQLite to actually store the data, one in memory (RAM) and one in a file (Flash). The data in file will be persistent even when the application is killed, while the data in memory (RAM) will vanish in such cases. The data will internally be buffered in memory (RAM) first, and will be moved into file database when certain conditions are met:</p>
<ul>
<li>in memory database overflows when inserting data</li>
<li>manually call update function with “persist=true” query parameter</li>
</ul>
<p>The data in memory (RAM) database will be deleted when it is moved to in file database.</p>
<h2><a class="anchor" id="retention_rate"></a>
Retention Rate</h2>
<p>Old data in persistent database will be deleted after it exceeds the retention time (and has been sent to CommonSense, if applicable). The Retention Time is gathered from preferences (see <a class="el" href="classnl_1_1sense__os_1_1service_1_1constants_1_1_sense_prefs_1_1_main_1_1_advanced.html#a4e11c8d72042e3c0327b9062c82a99c8">nl.sense_os.service.constants.SensePrefs.Main.Advanced.RETENTION_HOURS</a>), and has a default value of 24 hours (see <a class="el" href="classnl_1_1sense__os_1_1service_1_1storage_1_1_local_storage.html#a7d79f88f583e30af0d5a14602b833cb6">nl.sense_os.service.storage.LocalStorage.DEFAULT_RETENTION_HOURS</a>). </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Mar 30 2015 09:23:32 for Sense Android Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
